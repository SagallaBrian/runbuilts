"use strict";(self.webpackChunkbiz_ke_frontend=self.webpackChunkbiz_ke_frontend||[]).push([[88],{3088:(vt,b,l)=>{l.r(b),l.d(b,{InvoiceModule:()=>gt});var d=l(9808),m=l(1083),s=l(3075),h=l(7423),A=l(508),f=l(6856),g=l(7322),C=l(5245),x=l(7531),T=l(4107),Z=l(7261),v=l(4376),P=l(6186),U=l(4586),_=l(8966),y=l(5906),t=l(5e3),N=l(7347);function q(i,r){if(1&i&&(t.TgZ(0,"div",25),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function k(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",26),t._uU(2),t.qZA(),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("value",1*e.value),t.xp6(1),t.hij(" ",e.name,"")}}function J(i,r){1&i&&(t.ynx(0),t._UZ(1,"i",27),t.TgZ(2,"span",28),t._uU(3,"Loading..."),t.qZA(),t.BQk())}function S(i,r){1&i&&t._uU(0," Add Payment ")}let F=(()=>{class i{constructor(e,n,o,a,c,u){this.payFb=e,this.router=n,this.snakBar=o,this.payServ=a,this.dialogRef=c,this.data=u,this.matcher=new y.n,this.loading=!1,this.today=new Date,this.modeOfPay=[{name:"CASH",value:1},{name:"MPESA",value:2},{name:"PAYPAL",value:3},{name:"CHEQUE",value:4}],this.paynvcForm=this.payFb.group({lsolponvcid:["",s.kI.required],totalamount:[0,s.kI.required],totalpaid:[0,s.kI.required],modeofpay:["",s.kI.required],transactioncode:["",s.kI.required],paymentdate:[this.today,s.kI.required],details:[""]})}ngOnInit(){this.paynvcForm.valueChanges.subscribe(()=>{this.errorMessage=!1}),this.setDefualts(this.data)}setDefualts(e){this.paynvcForm.patchValue({lsolponvcid:e[0].id,totalamount:this.totalAmountSum(e)-e[0].nvclsopaidamount})}totalAmountSum(e){let n=0;return e.forEach(o=>{n+=o.totalamount}),n}addPayNvc(){this.loading=!0;let e=this.paynvcForm.value;e.paymentdate=(0,d.p6)(e.paymentdate,"yyyy-MM-dd","en-US"),this.payServ.addPayInvoice(e).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/income/invoice"]),this.dialogRef.close()}errorHandle(e){this.loading=!1,this.errorMessage=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(s.qu),t.Y36(m.F0),t.Y36(Z.ux),t.Y36(N.I),t.Y36(_.so),t.Y36(_.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-pay-nvc-dialog"]],decls:47,vars:14,consts:[[3,"formGroup"],[1,"d-flex"],[1,"flex-grow-1"],["mat-dialog-title","",1,"text-success","fw-normal"],["mat-dialog-close","","color","danger"],["mat-dialog-content",""],["class","alert alert-danger my-3",4,"ngIf"],[1,"row"],[1,"col-lg-12"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher"],[1,"col-lg-12","pb-4"],["formControlName","modeofpay"],["value","","disabled",""],[4,"ngFor","ngForOf"],[1,"col-lg-6"],["matInput","","placeholder","Enter Transaction code","formControlName","transactioncode",3,"errorStateMatcher"],["matInput","","formControlName","paymentdate",3,"matDatepicker"],["matSuffix","",3,"for"],["paydateid",""],["matInput","","formControlName","details"],["mat-dialog-actions","","align","end"],["mat-flat-button","","color","primary","type","button",1,"me-3",3,"disabled","click"],[4,"ngIf","ngIfElse"],["notload",""],[1,"alert","alert-danger","my-3"],[3,"value"],[1,"fa","fa-spinner","fa-spin","fa-1x","me-2"],[1,""]],template:function(e,n){if(1&e&&(t.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4),t.ALo(5,"number"),t.qZA()(),t.TgZ(6,"div")(7,"mat-icon",4),t._uU(8,"close"),t.qZA()()(),t.TgZ(9,"div",5),t.YNc(10,q,2,1,"div",6),t.TgZ(11,"div",7)(12,"div",8)(13,"mat-form-field",9)(14,"mat-label"),t._uU(15,"Total Amount"),t.qZA(),t._UZ(16,"input",10),t.qZA()()(),t.TgZ(17,"div",7)(18,"div",11)(19,"ng-select",12)(20,"ng-option",13),t._uU(21,"Select Mode OF Payment"),t.qZA(),t.YNc(22,k,3,2,"ng-container",14),t.qZA()(),t.TgZ(23,"div",15)(24,"mat-form-field",9)(25,"mat-label"),t._uU(26,"Transaction Code"),t.qZA(),t._UZ(27,"input",16),t.qZA()(),t.TgZ(28,"div",15)(29,"mat-form-field",9)(30,"mat-label"),t._uU(31,"Payment Date"),t.qZA(),t._UZ(32,"input",17)(33,"mat-datepicker-toggle",18)(34,"mat-datepicker",null,19),t.qZA()()(),t.TgZ(36,"div",7)(37,"div",8)(38,"mat-form-field",9)(39,"mat-label"),t._uU(40,"Payment Description"),t.qZA(),t._UZ(41,"textarea",20),t.qZA()()()(),t.TgZ(42,"div",21)(43,"button",22),t.NdJ("click",function(){return n.addPayNvc()}),t.YNc(44,J,4,0,"ng-container",23),t.YNc(45,S,1,0,"ng-template",null,24,t.W1O),t.qZA()()()),2&e){const o=t.MAs(35),a=t.MAs(46);t.Q6J("formGroup",n.paynvcForm),t.xp6(4),t.hij(" Payment for Invoice # ",t.xi3(5,11,n.data[0].id,"3.0-0")," "),t.xp6(6),t.Q6J("ngIf",n.errorMessage),t.xp6(6),t.Q6J("errorStateMatcher",n.matcher),t.xp6(6),t.Q6J("ngForOf",n.modeOfPay),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("matDatepicker",o),t.xp6(1),t.Q6J("for",o),t.xp6(10),t.Q6J("disabled",n.paynvcForm.invalid||n.errorMessage||n.loading),t.xp6(1),t.Q6J("ngIf",n.loading)("ngIfElse",a)}},directives:[s._Y,s.JL,s.sg,_.uh,C.Hw,_.ZT,_.xY,d.O5,g.KE,g.hX,x.Nt,s.Fj,s.JJ,s.u,v.w9,v.jq,d.sg,f.hl,f.nW,g.R9,f.Mq,_.H8,h.lW],pipes:[d.JJ],styles:[""]}),i})();var p=l(2340),Q=l(520);let I=(()=>{class i{constructor(e){this._http=e}addInvoice(e){return this._http.post(p.N.apiUrl+"invoice/",e)}addOneInvoice(e){return this._http.post(p.N.apiUrl+"invoice/one/",e)}updatInvoice(e,n){return this._http.put(p.N.apiUrl+"invoice/"+n,e)}updatOneInvoice(e,n){return this._http.patch(p.N.apiUrl+"invoice/"+n,e)}delInvoice(e){return this._http.delete(p.N.apiUrl+"invoice/"+e)}delOneInvoice(e){return this._http.delete(p.N.apiUrl+"invoice/one/"+e)}getInvoice(e){return this._http.get(p.N.apiUrl+"invoice/"+e)}getInvoices(e){return this._http.get(p.N.apiUrl+"invoice/",{params:e})}getClients(e){return this._http.get(p.N.apiUrl+"clients/",{params:e})}getProducts(e){return this._http.get(p.N.apiUrl+"product/",{params:e})}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(Q.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var E=l(1990),M=l(5876),O=l(4701);function w(i,r){if(1&i&&(t.TgZ(0,"div",5),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function Y(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).openDialog(o)}),t._uU(1," Pay "),t.qZA()}}const H=function(i){return["edit/",i]},D=function(i,r,e,n){return{"bg-danger":i,"bg-success":r,"bg-primary":e,"bg-warning":n}};function L(i,r){if(1&i&&(t.TgZ(0,"tr",12)(1,"td",13),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.ALo(5,"number"),t.qZA(),t.TgZ(6,"td",13),t._uU(7),t.ALo(8,"currency"),t.qZA(),t.TgZ(9,"td",13),t._uU(10),t.ALo(11,"currency"),t.qZA(),t.TgZ(12,"td",13),t._uU(13),t.ALo(14,"date"),t.qZA(),t.TgZ(15,"td",13),t._uU(16),t.qZA(),t.TgZ(17,"td",13)(18,"span",14),t._uU(19),t.qZA()(),t.TgZ(20,"td",13),t._uU(21),t.qZA(),t.TgZ(22,"td",15),t.NdJ("click",function(n){return n.stopPropagation()}),t._UZ(23,"app-print-receipt-dialog",16),t.YNc(24,Y,2,0,"button",17),t.qZA()()),2&i){const e=r.$implicit,n=r.index,o=t.oxw(2);t.Q6J("routerLink",t.VKq(25,H,e[0].uniqids)),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(t.xi3(5,14,e[0].id,"3.0-0")),t.xp6(3),t.Oqu(t.xi3(8,17,o.totalAmountSum(e),"Ksh. ")),t.xp6(3),t.Oqu(t.xi3(11,20,e[0].nvclsopaidamount,"Ksh. ")),t.xp6(3),t.Oqu(t.lcZ(14,23,e[0].paymentdate)),t.xp6(3),t.Oqu(e[0].suppliername),t.xp6(2),t.Q6J("ngClass",t.l5B(27,D,1==o.invoiceStatus(e,e[0].nvclsopaidamount).value,2==o.invoiceStatus(e,e[0].nvclsopaidamount).value,3==o.invoiceStatus(e,e[0].nvclsopaidamount).value,4==o.invoiceStatus(e,e[0].nvclsopaidamount).value)),t.xp6(1),t.hij(" ",o.invoiceStatus(e,e[0].nvclsopaidamount).name," "),t.xp6(2),t.Oqu(e[0].details),t.xp6(2),t.Q6J("tabledata",e)("labeldata",o.printitle)("printid",n),t.xp6(1),t.Q6J("ngIf",2!==o.invoiceStatus(e,e[0].nvclsopaidamount).value)}}function B(i,r){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"table",7)(3,"tbody")(4,"tr",8)(5,"th",9),t._uU(6,"#"),t.qZA(),t.TgZ(7,"th",9),t._uU(8,"Invoice Number"),t.qZA(),t.TgZ(9,"th",9),t._uU(10,"Invoice Amount"),t.qZA(),t.TgZ(11,"th",9),t._uU(12,"Amount Paid"),t.qZA(),t.TgZ(13,"th",9),t._uU(14,"Transaction Date"),t.qZA(),t.TgZ(15,"th",9),t._uU(16,"Client Name"),t.qZA(),t.TgZ(17,"th",9),t._uU(18,"Status"),t.qZA(),t.TgZ(19,"th",9),t._uU(20,"Description"),t.qZA(),t.TgZ(21,"th",9),t._uU(22,"Action"),t.qZA()(),t.YNc(23,L,25,32,"tr",10),t.qZA()()(),t.TgZ(24,"app-paginator",11),t.NdJ("newItemEvent",function(o){return t.CHM(e),t.oxw().paginatedCall(o)}),t.qZA(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(23),t.Q6J("ngForOf",e.invoices),t.xp6(1),t.Q6J("datafromdb",e.paginator)}}function j(i,r){if(1&i&&(t.TgZ(0,"div",20),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.loadmessage)}}function K(i,r){if(1&i&&t.YNc(0,j,2,1,"div",19),2&i){const e=t.oxw();t.Q6J("ngIf",e.loading)}}let R=(()=>{class i{constructor(e,n,o){this.lsoServ=e,this.router=n,this.dialog=o,this.loading=!0,this.printitle="INVOICE",this.loadmessage="loading ...",this.ifSearched=!1,this.paginator={page:1,pageSize:10},this.options=[{searchName:"Transaction Date",searchParam:"paymentdate"}],this.labels={listname:"Invoice List",addBtname:"Add Invoice",searchPlaceholder:"Search Invoice"}}ngOnInit(){this.loadInvoices()}loadInvoices(){this.lsoServ.getInvoices(this.paginator).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}handleResp(e){this.loading=!1,this.invoices=e.results,this.ifSearched||(this.invoiceStore=e),this.setPaginator(e)}errorHandle(e){this.loading=!1,this.errorMessage=e}paginatedCall(e){this.ifSearched=!1,this.setPaginator(this.invoiceStore),this.paginator.page=e.page,this.loadInvoices()}searchFunction(e){this.setPaginator(this.invoiceStore),this.errorMessage=null,this.ifSearched=!0,this.invoices=this.invoiceStore.results,this.paginator[e.searchParam]=e.searchValue,this.invoices=this.invoices.filter(n=>{var o;let a=(null===(o=n[e.searchParam])||void 0===o?void 0:o.toString())||"";return new RegExp(e.searchValue,"i").test(a)}),0==this.invoices.length&&(this.paginator.page=1,this.loading=!0,this.loadmessage="Performing a Wider Search",this.loadInvoices())}closeSearchFunction(){this.invoices=this.invoiceStore.results,this.errorMessage=null,this.setPaginator(this.invoiceStore)}setPaginator(e){this.paginator={page:1,pageSize:10},this.paginator.page=e.currentPage,this.paginator.totalItems=e.totalItems,this.paginator.pageSize=e.pageSize}navigateAdd(){this.router.navigate(["/income/invoice/add"])}totalAmountSum(e){let n=0;return e.forEach(o=>{n+=o.totalamount}),n}invoiceStatus(e,n){let o=0;return e.forEach(a=>{o+=a.totalamount}),0==n&&0!==o?{value:1,name:"Not Paid"}:0!==n&&o==n?{value:2,name:"Fully paid"}:0!==n&&o<n?{value:3,name:"Overpayment"}:{value:4,name:"Partially Paid"}}openDialog(e){this.dialog.open(F,{width:"70%",data:e}).afterClosed().subscribe(o=>{console.log("The dialog was closed"),this.loadInvoices()})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(I),t.Y36(m.F0),t.Y36(_.uw))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-list-invoices"]],decls:6,vars:6,consts:[[1,"container-fluid","py-3"],[3,"labels","searchoptions","backenddata","searchEmit","closeEmit","navigateEmit"],["class","alert alert-danger my-3",4,"ngIf"],[4,"ngIf","ngIfElse"],["nodata",""],[1,"alert","alert-danger","my-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-bordered","text-nowrap"],[1,"blhead","rounded"],[1,"text-light"],["class","cursor",3,"routerLink",4,"ngFor","ngForOf"],[3,"datafromdb","newItemEvent"],[1,"cursor",3,"routerLink"],[1,"tpad"],[1,"badge",3,"ngClass"],[1,"tpad",3,"click"],[3,"tabledata","labeldata","printid"],["class","btn btn-outline-primary ms-2 btn-sm py-0",3,"click",4,"ngIf"],[1,"btn","btn-outline-primary","ms-2","btn-sm","py-0",3,"click"],["class","alert alert-warning text-danger my-3",4,"ngIf"],[1,"alert","alert-warning","text-danger","my-3"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"app-search-tab",1),t.NdJ("searchEmit",function(a){return n.searchFunction(a)})("closeEmit",function(){return n.closeSearchFunction()})("navigateEmit",function(){return n.navigateAdd()}),t.qZA(),t.YNc(2,w,2,1,"div",2),t.YNc(3,B,25,2,"ng-container",3),t.YNc(4,K,1,1,"ng-template",null,4,t.W1O),t.qZA()),2&e){const o=t.MAs(5);t.xp6(1),t.Q6J("labels",n.labels)("searchoptions",n.options)("backenddata",n.invoices),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(1),t.Q6J("ngIf",n.invoices&&!n.loading&&!n.errorMessage)("ngIfElse",o)}},directives:[E.O,d.O5,d.sg,m.rH,d.mk,M.P,O.J],pipes:[d.JJ,d.H9,d.uU],styles:[""]}),i})();function z(i,r){if(1&i&&(t.TgZ(0,"div",22),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function V(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",25),t._uU(2),t.qZA(),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.hij(" ",e.fullname.toUpperCase(),"")}}function G(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",23),t._uU(2,"Please Select A Client"),t.qZA(),t.YNc(3,V,3,2,"ng-container",24),t.BQk()),2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.clients)}}function X(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",25),t._uU(2),t.qZA(),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.HOy(" ",e.categoryname.toUpperCase()," - ",e.brand.toUpperCase()," - ",e.prdtype.toUpperCase()," - ",e.calibration.toUpperCase()," ")}}function W(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",23),t._uU(2,"Please Select A Product"),t.qZA(),t.YNc(3,X,3,5,"ng-container",24),t.BQk()),2&i){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.products)}}function $(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",40)(1,"button",41),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().index;return t.oxw().editSinglPay(o)}),t._UZ(2,"i",42),t.qZA()()}if(2&i){const e=t.oxw().index,n=t.oxw();t.xp6(1),t.Q6J("disabled",n.getProducts.at(e).pristine||n.getProducts.at(e).invalid)}}function tt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",40)(1,"button",43),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().index;return t.oxw().saveProduct(o)}),t._UZ(2,"i",19),t.qZA()()}if(2&i){const e=t.oxw().index,n=t.oxw();t.xp6(1),t.Q6J("disabled",n.getProducts.at(e).invalid)}}function et(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",26)(1,"div",27)(2,"div",28)(3,"div",10)(4,"div",29)(5,"ng-select",30),t.NdJ("change",function(){const a=t.CHM(e).index;return t.oxw().changeProduct(a)}),t.YNc(6,W,4,1,"ng-container",9),t.qZA()(),t.TgZ(7,"div",31)(8,"mat-form-field",11)(9,"mat-label"),t._uU(10," No Of Items"),t.qZA(),t.TgZ(11,"input",32),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().noitmKeyUp(o.target,c)}),t.qZA()()(),t.TgZ(12,"div",31)(13,"mat-form-field",11)(14,"mat-label"),t._uU(15,"Unit Price"),t.qZA(),t.TgZ(16,"input",33),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().unitKeyUp(o.target,c)}),t.qZA()()(),t.TgZ(17,"div",34)(18,"mat-form-field",11)(19,"mat-label"),t._uU(20,"Total Amount"),t.qZA(),t.TgZ(21,"input",35),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().totlKeyup(o.target,c)}),t.qZA()()()()(),t.TgZ(22,"div",36)(23,"div",27)(24,"div",36)(25,"button",37),t.NdJ("click",function(){const a=t.CHM(e).index;return t.oxw().delOnePrd(a)}),t._UZ(26,"i",38),t.qZA()(),t.YNc(27,$,3,1,"div",39),t.YNc(28,tt,3,1,"div",39),t.qZA()()()()}if(2&i){const e=r.index,n=t.oxw();let o,a;t.Q6J("formGroupName",e),t.xp6(6),t.Q6J("ngIf",n.products),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(6),t.Q6J("ngIf",null==(o=n.getProducts.at(e).get("transacid"))?null:o.value),t.xp6(1),t.Q6J("ngIf",!(null!=(a=n.getProducts.at(e).get("transacid"))&&a.value))}}let nt=(()=>{class i{constructor(e,n,o,a,c){this.nvcFb=e,this.router=n,this.snakBar=o,this.lsoServ=a,this.route=c,this.matcher=new y.n,this.loading=!1,this.invoiceForm=this.nvcFb.group({clisupid:["",s.kI.required],products:this.nvcFb.array([]),details:[""]})}ngOnInit(){this.loadProd(),this.loadClients(),this.unqpayids=this.route.snapshot.paramMap.get("id"),this.unqpayids&&this.loadInvoice(),this.invoiceForm.valueChanges.subscribe(()=>{this.errorMessage=!1})}loadProd(){this.lsoServ.getProducts({page:1,pageSize:10}).subscribe({next:e=>this.products=e.results,error:e=>this.errorHandle(e)})}loadClients(){this.lsoServ.getClients({page:1,pageSize:10}).subscribe({next:e=>this.clients=e.results,error:e=>this.errorHandle(e)})}loadInvoice(){this.loading=!0,this.lsoServ.getInvoice(this.unqpayids).subscribe({next:e=>this.respPayment(e),error:e=>this.errorHandle(e)})}get getProducts(){return this.invoiceForm.get("products")}addProduct(e,n,o,a){const c=this.nvcFb.group({productid:[e||"",s.kI.required],transacid:[n],noitems:[o||0,[s.kI.required,s.kI.min(1)]],unitprice:[a/o||0,s.kI.required],totalamount:[a||0,[s.kI.required,s.kI.min(1)]]});this.getProducts.push(c)}delOnePrd(e){var n;const o=parseInt(null===(n=this.getProducts.at(e).get("transacid"))||void 0===n?void 0:n.value);o?(this.loading=!0,this.lsoServ.delOneInvoice(o).subscribe({next:a=>this.respOneDel(a),error:a=>this.errorHandle(a)})):this.getProducts.removeAt(e)}saveProduct(e){let n=this.invoiceForm.value,o={};o.clisupid=n.clisupid,o.modeofpay=n.modeofpay,o.transactioncode=n.transactioncode,o.details=n.details,o.transacid=this.unqpayids;const a=Object.assign(Object.assign({},this.getProducts.at(e).value),o);this.lsoServ.addOneInvoice(a).subscribe({next:c=>this.respOneDel(c),error:c=>this.errorHandle(c)})}editSinglPay(e){this.loading=!0;const n=this.getProducts.at(e).value,o=parseInt(n.transacid);this.lsoServ.updatOneInvoice(n,o).subscribe({next:a=>this.respOneDel(a),error:a=>this.errorHandle(a)})}editOverallPay(){this.loading=!0,this.lsoServ.updatInvoice(this.invoiceForm.value,this.unqpayids).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}delOverallPay(){this.loading=!0,this.lsoServ.delInvoice(this.unqpayids).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/income/invoice"])}respOneDel(e){this.loading=!1,this.loadInvoice()}errorHandle(e){this.loading=!1,this.errorMessage=e}respPayment(e){this.loading=!1,this.getProducts.clear(),0==e.length?this.router.navigate(["/income/invoice"]):(this.invoiceForm.patchValue({clisupid:e[0].clisupid,modeofpay:e[0].modeofpay,transactioncode:e[0].transactioncode,paymentdate:e[0].paymentdate,details:e[0].details}),e.forEach(n=>{this.addProduct(n.productid,n.id,n.noitems,n.totalamount)}))}unitKeyUp(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value);null===(a=this.getProducts.at(n).get("totalamount"))||void 0===a||a.setValue(e.value*c)}totlKeyup(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value)||1;null===(a=this.getProducts.at(n).get("unitprice"))||void 0===a||a.setValue(e.value/c)}noitmKeyUp(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("unitprice"))||void 0===o?void 0:o.value);null===(a=this.getProducts.at(n).get("totalamount"))||void 0===a||a.setValue(e.value*c)}changeProduct(e){var n,o;const a=null===(n=this.getProducts.at(e).get("productid"))||void 0===n?void 0:n.value,c=this.products.find(u=>u.id==a);null===(o=this.getProducts.at(e).get("unitprice"))||void 0===o||o.setValue(c.defsellprice)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(s.qu),t.Y36(m.F0),t.Y36(Z.ux),t.Y36(I),t.Y36(m.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-edit-invoice"]],decls:29,vars:6,consts:[[1,"d-lg-flex","text-secondary","py-2"],[1,"flex-grow-1"],["type","button","routerLink","/income/invoice",1,"btn","btn-outline-success","btn-sm"],["aria-hidden","true",1,"fa","fa-chevron-left"],[3,"formGroup"],["class","alert alert-danger my-3",4,"ngIf"],[1,"row","pb-4"],[1,"col-lg-12"],["formControlName","clisupid"],[4,"ngIf"],[1,"row"],["appearance","outline",1,"w-100"],["matInput","","formControlName","details"],["formArrayName","products"],[1,"pt-2","pb-1"],[1,"bg-secondary-light","py-2"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"text-end"],["type","button",1,"btn","btn-primary","my-2",3,"click"],[1,"fa","fa-plus"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"disabled","click"],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[1,"alert","alert-danger","my-3"],["value","","disabled",""],[4,"ngFor","ngForOf"],[3,"value"],[3,"formGroupName"],[1,"d-flex"],[1,"flex-grow-1","me-2"],[1,"col-lg-5","pt-1"],["formControlName","productid",3,"change"],[1,"col-lg-2"],["matInput","","placeholder","Enter No Of Items e.g. 50","formControlName","noitems",3,"errorStateMatcher","keyup"],["matInput","","placeholder","Enter Unit","formControlName","unitprice",3,"errorStateMatcher","keyup"],[1,"col-lg-3"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher","keyup"],[1,""],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"],["class","ms-1",4,"ngIf"],[1,"ms-1"],[1,"btn","btn-success",3,"disabled","click"],[1,"fa","fa-save"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._UZ(3,"i",3),t._uU(4," Back "),t.qZA()()(),t.TgZ(5,"form",4),t.YNc(6,z,2,1,"div",5),t.TgZ(7,"div",6)(8,"div",7)(9,"ng-select",8),t.YNc(10,G,4,1,"ng-container",9),t.qZA()()(),t.TgZ(11,"div",10)(12,"div",7)(13,"mat-form-field",11)(14,"mat-label"),t._uU(15,"Payment Description"),t.qZA(),t._UZ(16,"textarea",12),t.qZA()()(),t.TgZ(17,"div",13)(18,"div",14),t._uU(19," Products"),t.qZA(),t.TgZ(20,"div",15),t.YNc(21,et,29,7,"div",16),t.qZA(),t.TgZ(22,"div",17)(23,"button",18),t.NdJ("click",function(){return n.addProduct()}),t._UZ(24,"i",19),t.qZA()()(),t.TgZ(25,"button",20),t.NdJ("click",function(){return n.delOverallPay()}),t._uU(26,"Delete"),t.qZA(),t.TgZ(27,"button",21),t.NdJ("click",function(){return n.editOverallPay()}),t._uU(28,"Save Changes "),t.qZA()()),2&e&&(t.xp6(5),t.Q6J("formGroup",n.invoiceForm),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(4),t.Q6J("ngIf",n.clients),t.xp6(11),t.Q6J("ngForOf",n.getProducts.controls),t.xp6(4),t.Q6J("disabled",n.errorMessage||n.loading),t.xp6(2),t.Q6J("disabled",n.invoiceForm.invalid||n.invoiceForm.pristine))},directives:[m.rH,s._Y,s.JL,s.sg,d.O5,v.w9,s.JJ,s.u,v.jq,d.sg,g.KE,g.hX,x.Nt,s.Fj,s.CE,s.x0,h.lW],styles:[".mat-form-field-flex>.mat-form-field-infix{padding:.5em 0!important}  .mat-form-field-label-wrapper{top:-1.4em}  .mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{transform:translateY(-1.1em) scale(.75);width:133.33333%}"]}),i})();function ot(i,r){if(1&i&&(t.TgZ(0,"div",23),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function it(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",26),t._uU(2),t.qZA(),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.hij(" ",e.fullname.toUpperCase(),"")}}function at(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",24),t._uU(2,"Please Select A Client"),t.qZA(),t.YNc(3,it,3,2,"ng-container",25),t.BQk()),2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.clients)}}function rt(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",26),t._uU(2),t.qZA(),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.HOy(" ",e.categoryname.toUpperCase()," - ",e.brand.toUpperCase()," - ",e.prdtype.toUpperCase()," - ",e.calibration.toUpperCase()," ")}}function st(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"ng-option",24),t._uU(2,"Please Select A Product"),t.qZA(),t.YNc(3,rt,3,5,"ng-container",25),t.BQk()),2&i){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.products)}}function ct(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",10)(4,"div",30)(5,"ng-select",31),t.NdJ("change",function(){const a=t.CHM(e).index;return t.oxw().changeProduct(a)}),t.YNc(6,st,4,1,"ng-container",9),t.qZA()(),t.TgZ(7,"div",32)(8,"mat-form-field",11)(9,"mat-label"),t._uU(10," No Of Items"),t.qZA(),t.TgZ(11,"input",33),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().noitmKeyUp(o.target,c)}),t.qZA()()(),t.TgZ(12,"div",32)(13,"mat-form-field",11)(14,"mat-label"),t._uU(15,"Unit Price"),t.qZA(),t.TgZ(16,"input",34),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().unitKeyUp(o.target,c)}),t.qZA()()(),t.TgZ(17,"div",35)(18,"mat-form-field",11)(19,"mat-label"),t._uU(20,"Total Amount"),t.qZA(),t.TgZ(21,"input",36),t.NdJ("keyup",function(o){const c=t.CHM(e).index;return t.oxw().totlKeyup(o.target,c)}),t.qZA()()()()(),t.TgZ(22,"div",37)(23,"button",38),t.NdJ("click",function(){const a=t.CHM(e).index;return t.oxw().delProduct(a)}),t._UZ(24,"i",39),t.qZA()()()()}if(2&i){const e=r.index,n=t.oxw();t.Q6J("formGroupName",e),t.xp6(6),t.Q6J("ngIf",n.products),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(2),t.Q6J("disabled",0==e)}}function lt(i,r){1&i&&(t.ynx(0),t._UZ(1,"i",40),t.TgZ(2,"span",37),t._uU(3,"Loading..."),t.qZA(),t.BQk())}function dt(i,r){1&i&&t._uU(0," Add Invoice ")}let ut=(()=>{class i{constructor(e,n,o,a){this.nvcFb=e,this.router=n,this.snakBar=o,this.nvcServ=a,this.matcher=new y.n,this.loading=!1,this.today=new Date,this.invoiceForm=this.nvcFb.group({clisupid:["",s.kI.required],products:this.nvcFb.array([]),details:[""]})}ngOnInit(){this.loadProd(),this.loadSuppl(),this.addProduct(),this.invoiceForm.valueChanges.subscribe(()=>{this.errorMessage=!1})}get getProducts(){return this.invoiceForm.get("products")}addProduct(){const e=this.nvcFb.group({productid:["",s.kI.required],noitems:[0,s.kI.required],unitprice:[0,s.kI.required],totalamount:[0,s.kI.required]});this.getProducts.push(e)}delProduct(e){this.getProducts.removeAt(e)}loadProd(){this.nvcServ.getProducts({page:1,pageSize:10}).subscribe({next:e=>this.products=e.results,error:e=>this.errorHandle(e)})}loadSuppl(){this.nvcServ.getClients({page:1,pageSize:10}).subscribe({next:e=>this.clients=e.results,error:e=>this.errorHandle(e)})}addPay(){this.loading=!0,this.nvcServ.addInvoice(this.invoiceForm.value).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/income/invoice"])}errorHandle(e){this.loading=!1,this.errorMessage=e}unitKeyUp(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value);null===(a=this.getProducts.at(n).get("totalamount"))||void 0===a||a.setValue(e.value*c)}totlKeyup(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value)||1;null===(a=this.getProducts.at(n).get("unitprice"))||void 0===a||a.setValue(e.value/c)}noitmKeyUp(e,n){var o,a;const c=parseInt(null===(o=this.getProducts.at(n).get("unitprice"))||void 0===o?void 0:o.value);null===(a=this.getProducts.at(n).get("totalamount"))||void 0===a||a.setValue(e.value*c)}changeProduct(e){var n,o;const a=null===(n=this.getProducts.at(e).get("productid"))||void 0===n?void 0:n.value,c=this.products.find(u=>u.id==a);null===(o=this.getProducts.at(e).get("unitprice"))||void 0===o||o.setValue(c.defsellprice)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(s.qu),t.Y36(m.F0),t.Y36(Z.ux),t.Y36(I))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-invoice"]],decls:29,vars:7,consts:[[1,"d-lg-flex","text-secondary","py-2"],[1,"flex-grow-1"],["type","button","routerLink","/income/invoice",1,"btn","btn-outline-success","btn-sm"],["aria-hidden","true",1,"fa","fa-chevron-left"],[3,"formGroup"],["class","alert alert-danger my-3",4,"ngIf"],[1,"row","pb-4"],[1,"col-lg-12"],["formControlName","clisupid"],[4,"ngIf"],[1,"row"],["appearance","outline",1,"w-100"],["matInput","","formControlName","details"],["formArrayName","products"],[1,"pt-2","pb-1"],[1,"bg-secondary-light","py-2"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"text-end"],["type","button",1,"btn","btn-primary","my-2",3,"click"],[1,"fa","fa-plus"],["mat-flat-button","","color","primary","type","button",1,"me-3",3,"disabled","click"],[4,"ngIf","ngIfElse"],["notload",""],[1,"alert","alert-danger","my-3"],["value","","disabled",""],[4,"ngFor","ngForOf"],[3,"value"],[3,"formGroupName"],[1,"d-flex"],[1,"flex-grow-1","me-2"],[1,"col-lg-5","pt-1"],["formControlName","productid",3,"change"],[1,"col-lg-2"],["matInput","","placeholder","Enter No Of Items e.g. 50","formControlName","noitems",3,"errorStateMatcher","keyup"],["matInput","","placeholder","Enter Unit","formControlName","unitprice",3,"errorStateMatcher","keyup"],[1,"col-lg-3"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher","keyup"],[1,""],[1,"btn","btn-danger",3,"disabled","click"],[1,"fa","fa-trash"],[1,"fa","fa-spinner","fa-spin","fa-1x","me-2"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._UZ(3,"i",3),t._uU(4," Back "),t.qZA()()(),t.TgZ(5,"form",4),t.YNc(6,ot,2,1,"div",5),t.TgZ(7,"div",6)(8,"div",7)(9,"ng-select",8),t.YNc(10,at,4,1,"ng-container",9),t.qZA()()(),t.TgZ(11,"div",10)(12,"div",7)(13,"mat-form-field",11)(14,"mat-label"),t._uU(15,"Payment Description"),t.qZA(),t._UZ(16,"textarea",12),t.qZA()()(),t.TgZ(17,"div",13)(18,"div",14),t._uU(19," Add Products"),t.qZA(),t.TgZ(20,"div",15),t.YNc(21,ct,25,6,"div",16),t.qZA(),t.TgZ(22,"div",17)(23,"button",18),t.NdJ("click",function(){return n.addProduct()}),t._UZ(24,"i",19),t.qZA()()(),t.TgZ(25,"button",20),t.NdJ("click",function(){return n.addPay()}),t.YNc(26,lt,4,0,"ng-container",21),t.YNc(27,dt,1,0,"ng-template",null,22,t.W1O),t.qZA()()),2&e){const o=t.MAs(28);t.xp6(5),t.Q6J("formGroup",n.invoiceForm),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(4),t.Q6J("ngIf",n.clients),t.xp6(11),t.Q6J("ngForOf",n.getProducts.controls),t.xp6(4),t.Q6J("disabled",n.invoiceForm.invalid||n.errorMessage||n.loading),t.xp6(1),t.Q6J("ngIf",n.loading)("ngIfElse",o)}},directives:[m.rH,s._Y,s.JL,s.sg,d.O5,v.w9,s.JJ,s.u,v.jq,d.sg,g.KE,g.hX,x.Nt,s.Fj,s.CE,s.x0,h.lW],styles:[".mat-form-field-flex>.mat-form-field-infix{padding:.5em 0!important}  .mat-form-field-label-wrapper{top:-1.4em}  .mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{transform:translateY(-1.1em) scale(.75);width:133.33333%}"]}),i})();var pt=l(9744);const mt=[{path:"",component:R},{path:"add",component:ut},{path:"edit/:id",component:nt}];let gt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[d.ez,P.K,s.UX,v.A0,s.u5,Z.ZX,g.lN,T.LD,x.c,C.Ps,h.ot,A.XK,f.FA,U.D,pt.F,m.Bz.forChild(mt)]]}),i})()}}]);