"use strict";(self.webpackChunkbiz_ke_frontend=self.webpackChunkbiz_ke_frontend||[]).push([[39],{1039:(lt,P,l)=>{l.r(P),l.d(P,{PaymentModule:()=>dt});var p=l(9808),u=l(1083),t=l(5e3),c=l(2340),b=l(520);let f=(()=>{class a{constructor(e){this.http=e}addPayment(e){return this.http.post(c.N.apiUrl+"payment/",e)}addOnePayment(e){return this.http.post(c.N.apiUrl+"payment/one/",e)}updatePayment(e,n){return this.http.put(c.N.apiUrl+"payment/"+n,e)}updateOnePayment(e,n){return this.http.patch(c.N.apiUrl+"payment/"+n,e)}delPayment(e){return this.http.delete(c.N.apiUrl+"payment/"+e)}delOnePayment(e){return this.http.delete(c.N.apiUrl+"payment/one/"+e)}getPayment(e){return this.http.get(c.N.apiUrl+"payment/"+e)}getPayments(e){return this.http.get(c.N.apiUrl+"payment/",{params:e})}getSuppliers(e){return this.http.get(c.N.apiUrl+"supplier/",{params:e})}getProducts(e){return this.http.get(c.N.apiUrl+"product/",{params:e})}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(b.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var A=l(1990),C=l(5876),T=l(4701),U=l(2818);function q(a,i){if(1&a&&(t.TgZ(0,"div",5),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}const S=function(a){return["edit/",a]};function N(a,i){if(1&a&&(t.TgZ(0,"tr",12)(1,"td",13),t._uU(2),t.qZA(),t.TgZ(3,"td",13),t._uU(4),t.qZA(),t.TgZ(5,"td",13),t._uU(6),t.qZA(),t.TgZ(7,"td",13),t._uU(8),t.ALo(9,"modeofpay"),t.qZA(),t.TgZ(10,"td",13),t._uU(11),t.ALo(12,"currency"),t.qZA(),t.TgZ(13,"td",13),t._uU(14),t.ALo(15,"date"),t.qZA(),t.TgZ(16,"td",13),t._uU(17),t.qZA(),t.TgZ(18,"td",14),t.NdJ("click",function(n){return n.stopPropagation()}),t._UZ(19,"app-print-receipt-dialog",15),t.qZA()()),2&a){const e=i.$implicit,n=i.index,o=t.oxw(2);t.Q6J("routerLink",t.VKq(16,S,e[0].uniqids)),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(e[0].suppliername),t.xp6(2),t.Oqu(e[0].transactioncode),t.xp6(2),t.Oqu(t.lcZ(9,9,e[0].modeofpay)),t.xp6(3),t.Oqu(t.xi3(12,11,o.totalAmountSum(e),"Ksh. ")),t.xp6(3),t.Oqu(t.lcZ(15,14,e[0].paymentdate)),t.xp6(3),t.Oqu(e[0].details),t.xp6(2),t.Q6J("tabledata",e)}}function k(a,i){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"table",7)(3,"tbody")(4,"tr",8)(5,"th",9),t._uU(6,"#"),t.qZA(),t.TgZ(7,"th",9),t._uU(8,"Supplier Name"),t.qZA(),t.TgZ(9,"th",9),t._uU(10,"Transaction Code"),t.qZA(),t.TgZ(11,"th",9),t._uU(12,"Mode Of Payment"),t.qZA(),t.TgZ(13,"th",9),t._uU(14,"Total Amount"),t.qZA(),t.TgZ(15,"th",9),t._uU(16,"Transaction Date"),t.qZA(),t.TgZ(17,"th",9),t._uU(18,"Description"),t.qZA(),t.TgZ(19,"th",9),t._uU(20,"Print"),t.qZA()(),t.YNc(21,N,20,18,"tr",10),t.qZA()()(),t.TgZ(22,"app-paginator",11),t.NdJ("newItemEvent",function(o){return t.CHM(e),t.oxw().paginatedCall(o)}),t.qZA(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(21),t.Q6J("ngForOf",e.payments),t.xp6(1),t.Q6J("datafromdb",e.paginator)}}function J(a,i){if(1&a&&(t.TgZ(0,"div",17),t._uU(1),t.qZA()),2&a){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.loadmessage," ")}}function I(a,i){if(1&a&&t.YNc(0,J,2,1,"div",16),2&a){const e=t.oxw();t.Q6J("ngIf",e.loading)}}let M=(()=>{class a{constructor(e,n){this.payServ=e,this.router=n,this.loading=!0,this.loadmessage="loading ...",this.ifSearched=!1,this.paginator={page:1,pageSize:10},this.options=[{searchName:"Transaction Code",searchParam:"transactioncode"},{searchName:"Mode Of Payment",searchParam:"modeofpay"},{searchName:"Transaction Date",searchParam:"paymentdate"}],this.labels={listname:"Payment List",addBtname:"Add Payment",searchPlaceholder:"Search Payment"}}ngOnInit(){this.loadPayments()}loadPayments(){this.payServ.getPayments(this.paginator).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}handleResp(e){this.loading=!1,this.payments=e.results,this.ifSearched||(this.paymentStore=e),this.setPaginator(e)}errorHandle(e){this.loading=!1,this.errorMessage=e}paginatedCall(e){this.ifSearched=!1,this.setPaginator(this.paymentStore),this.paginator.page=e.page,this.loadPayments()}searchFunction(e){this.setPaginator(this.paymentStore),this.errorMessage=null,this.ifSearched=!0,this.payments=this.paymentStore.results,this.paginator[e.searchParam]=e.searchValue,this.payments=this.payments.filter(n=>{var o;let r=(null===(o=n[e.searchParam])||void 0===o?void 0:o.toString())||"";return new RegExp(e.searchValue,"i").test(r)}),0==this.payments.length&&(this.paginator.page=1,this.loading=!0,this.loadmessage="Performing a Wider Search",this.loadPayments())}closeSearchFunction(){this.payments=this.paymentStore.results,this.errorMessage=null,this.setPaginator(this.paymentStore)}setPaginator(e){this.paginator={page:1,pageSize:10},this.paginator.page=e.currentPage,this.paginator.totalItems=e.totalItems,this.paginator.pageSize=e.pageSize}navigateAdd(){this.router.navigate(["/expense/payment/add"])}totalAmountSum(e){let n=0;return e.forEach(o=>{n+=o.totalamount}),n}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(f),t.Y36(u.F0))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-list-payments"]],decls:6,vars:6,consts:[[1,"container-fluid","py-3"],[3,"labels","searchoptions","backenddata","searchEmit","closeEmit","navigateEmit"],["class","alert alert-danger my-3",4,"ngIf"],[4,"ngIf","ngIfElse"],["nodata",""],[1,"alert","alert-danger","my-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-bordered","text-nowrap"],[1,"blhead","rounded"],[1,"text-light"],["class","cursor",3,"routerLink",4,"ngFor","ngForOf"],[3,"datafromdb","newItemEvent"],[1,"cursor",3,"routerLink"],[1,"tpad"],[1,"tpad",3,"click"],[3,"tabledata"],["class","alert alert-warning text-danger my-3",4,"ngIf"],[1,"alert","alert-warning","text-danger","my-3"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"app-search-tab",1),t.NdJ("searchEmit",function(r){return n.searchFunction(r)})("closeEmit",function(){return n.closeSearchFunction()})("navigateEmit",function(){return n.navigateAdd()}),t.qZA(),t.YNc(2,q,2,1,"div",2),t.YNc(3,k,23,2,"ng-container",3),t.YNc(4,I,1,1,"ng-template",null,4,t.W1O),t.qZA()),2&e){const o=t.MAs(5);t.xp6(1),t.Q6J("labels",n.labels)("searchoptions",n.options)("backenddata",n.payments),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(1),t.Q6J("ngIf",n.payments&&!n.loading&&!n.errorMessage)("ngIfElse",o)}},directives:[A.O,p.O5,p.sg,u.rH,C.P,T.J],pipes:[U.p,p.H9,p.uU],styles:[""]}),a})();var d=l(3075),Z=l(5906),y=l(7261),h=l(4376),g=l(7322),v=l(7531),_=l(6856),x=l(7423);function Q(a,i){if(1&a&&(t.TgZ(0,"div",30),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function F(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",31),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.hij(" ",e.fullname.toUpperCase(),"")}}function E(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",11),t._uU(2,"Please Select A Supplier"),t.qZA(),t.YNc(3,F,3,2,"ng-container",12),t.BQk()),2&a){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.suppliers)}}function O(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",31),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.value),t.xp6(1),t.hij(" ",e.name,"")}}function w(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",31),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.HOy(" ",e.categoryname.toUpperCase()," - ",e.brand.toUpperCase()," - ",e.prdtype.toUpperCase()," - ",e.calibration.toUpperCase()," ")}}function Y(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",11),t._uU(2,"Please Select A Product"),t.qZA(),t.YNc(3,w,3,5,"ng-container",12),t.BQk()),2&a){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.products)}}function H(a,i){if(1&a){const e=t.EpF();t.TgZ(0,"div",46)(1,"button",47),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().index;return t.oxw().editSinglPay(o)}),t._UZ(2,"i",48),t.qZA()()}if(2&a){const e=t.oxw().index,n=t.oxw();t.xp6(1),t.Q6J("disabled",n.getProducts.at(e).pristine||n.getProducts.at(e).invalid)}}function L(a,i){if(1&a){const e=t.EpF();t.TgZ(0,"div",46)(1,"button",49),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().index;return t.oxw().saveProduct(o)}),t._UZ(2,"i",27),t.qZA()()}if(2&a){const e=t.oxw().index,n=t.oxw();t.xp6(1),t.Q6J("disabled",n.getProducts.at(e).invalid)}}function B(a,i){if(1&a){const e=t.EpF();t.TgZ(0,"div",32)(1,"div",33)(2,"div",34)(3,"div",13)(4,"div",35)(5,"ng-select",36),t.NdJ("change",function(){const r=t.CHM(e).index;return t.oxw().changeProduct(r)}),t.YNc(6,Y,4,1,"ng-container",9),t.qZA()(),t.TgZ(7,"div",37)(8,"mat-form-field",14)(9,"mat-label"),t._uU(10," No Of Items"),t.qZA(),t.TgZ(11,"input",38),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().noitmKeyUp(o.target,s)}),t.qZA()()(),t.TgZ(12,"div",37)(13,"mat-form-field",14)(14,"mat-label"),t._uU(15,"Unit Price"),t.qZA(),t.TgZ(16,"input",39),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().unitKeyUp(o.target,s)}),t.qZA()()(),t.TgZ(17,"div",40)(18,"mat-form-field",14)(19,"mat-label"),t._uU(20,"Total Amount"),t.qZA(),t.TgZ(21,"input",41),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().totlKeyup(o.target,s)}),t.qZA()()()()(),t.TgZ(22,"div",42)(23,"div",33)(24,"div",42)(25,"button",43),t.NdJ("click",function(){const r=t.CHM(e).index;return t.oxw().delOnePrd(r)}),t._UZ(26,"i",44),t.qZA()(),t.YNc(27,H,3,1,"div",45),t.YNc(28,L,3,1,"div",45),t.qZA()()()()}if(2&a){const e=i.index,n=t.oxw();let o,r;t.Q6J("formGroupName",e),t.xp6(6),t.Q6J("ngIf",n.products),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(6),t.Q6J("ngIf",null==(o=n.getProducts.at(e).get("transacid"))?null:o.value),t.xp6(1),t.Q6J("ngIf",!(null!=(r=n.getProducts.at(e).get("transacid"))&&r.value))}}let D=(()=>{class a{constructor(e,n,o,r,s){this.payFb=e,this.router=n,this.snakBar=o,this.payServ=r,this.route=s,this.matcher=new Z.n,this.loading=!1,this.today=new Date,this.modeOfPay=[{name:"CASH",value:1},{name:"MPESA",value:2},{name:"PAYPAL",value:3},{name:"CHEQUE",value:4}],this.payForm=this.payFb.group({clisupid:["",d.kI.required],modeofpay:["",d.kI.required],paymentdate:["",d.kI.required],transactioncode:["",d.kI.required],products:this.payFb.array([]),details:[""]})}ngOnInit(){this.loadProd(),this.loadSuppl(),this.unqpayids=this.route.snapshot.paramMap.get("id"),this.unqpayids&&this.loadPay(),this.payForm.valueChanges.subscribe(()=>{this.errorMessage=!1})}loadProd(){this.payServ.getProducts({page:1,pageSize:10}).subscribe({next:e=>this.products=e.results,error:e=>this.errorHandle(e)})}loadSuppl(){this.payServ.getSuppliers({page:1,pageSize:10}).subscribe({next:e=>this.suppliers=e.results,error:e=>this.errorHandle(e)})}loadPay(){this.loading=!0,this.payServ.getPayment(this.unqpayids).subscribe({next:e=>this.respPayment(e),error:e=>this.errorHandle(e)})}get getProducts(){return this.payForm.get("products")}addProduct(e,n,o,r){const s=this.payFb.group({productid:[e||"",d.kI.required],transacid:[n],noitems:[o||0,[d.kI.required,d.kI.min(1)]],unitprice:[r/o||0,d.kI.required],totalamount:[r||0,[d.kI.required,d.kI.min(1)]]});this.getProducts.push(s)}delOnePrd(e){var n;const o=parseInt(null===(n=this.getProducts.at(e).get("transacid"))||void 0===n?void 0:n.value);o?(this.loading=!0,this.payServ.delOnePayment(o).subscribe({next:r=>this.respOneDel(r),error:r=>this.errorHandle(r)})):this.getProducts.removeAt(e)}saveProduct(e){let n=this.payForm.value,o={};o.clisupid=n.clisupid,o.modeofpay=n.modeofpay,o.transactioncode=n.transactioncode,o.paymentdate=(0,p.p6)(n.paymentdate,"yyyy-MM-dd","en-US"),o.details=n.details,o.transacid=this.unqpayids;const r=Object.assign(Object.assign({},this.getProducts.at(e).value),o);this.payServ.addOnePayment(r).subscribe({next:s=>this.respOneDel(s),error:s=>this.errorHandle(s)})}editSinglPay(e){this.loading=!0;const n=this.getProducts.at(e).value,o=parseInt(n.transacid);this.payServ.updateOnePayment(n,o).subscribe({next:r=>this.respOneDel(r),error:r=>this.errorHandle(r)})}editOverallPay(){this.loading=!0;let e=this.payForm.value;e.paymentdate=(0,p.p6)(e.paymentdate,"yyyy-MM-dd","en-US"),this.payServ.updatePayment(e,this.unqpayids).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}delOverallPay(){this.loading=!0,this.payServ.delPayment(this.unqpayids).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/expense/payment"])}respOneDel(e){this.loading=!1,this.loadPay()}errorHandle(e){this.loading=!1,this.errorMessage=e}respPayment(e){this.loading=!1,this.getProducts.clear(),0==e.length?this.router.navigate(["/expense/payment"]):(this.payForm.patchValue({clisupid:e[0].clisupid,modeofpay:e[0].modeofpay,transactioncode:e[0].transactioncode,paymentdate:e[0].paymentdate,details:e[0].details}),e.forEach(n=>{this.addProduct(n.productid,n.id,n.noitems,n.totalamount)}))}unitKeyUp(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value);null===(r=this.getProducts.at(n).get("totalamount"))||void 0===r||r.setValue(e.value*s)}totlKeyup(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value)||1;null===(r=this.getProducts.at(n).get("unitprice"))||void 0===r||r.setValue(e.value/s)}noitmKeyUp(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("unitprice"))||void 0===o?void 0:o.value);null===(r=this.getProducts.at(n).get("totalamount"))||void 0===r||r.setValue(e.value*s)}changeProduct(e){var n,o;const r=null===(n=this.getProducts.at(e).get("productid"))||void 0===n?void 0:n.value,s=this.products.find(m=>m.id==r);null===(o=this.getProducts.at(e).get("unitprice"))||void 0===o||o.setValue(s.defbuyprice)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(d.qu),t.Y36(u.F0),t.Y36(y.ux),t.Y36(f),t.Y36(u.gz))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-edit-payment"]],decls:48,vars:10,consts:[[1,"d-lg-flex","text-secondary","py-2"],[1,"flex-grow-1"],["type","button","routerLink","/expense/payment",1,"btn","btn-outline-success","btn-sm"],["aria-hidden","true",1,"fa","fa-chevron-left"],[3,"formGroup"],["class","alert alert-danger my-3",4,"ngIf"],[1,"row","pb-4"],[1,"col-lg-6"],["formControlName","clisupid"],[4,"ngIf"],["formControlName","modeofpay"],["value","","disabled",""],[4,"ngFor","ngForOf"],[1,"row"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Enter Transaction code","formControlName","transactioncode",3,"errorStateMatcher"],["matInput","","formControlName","paymentdate",3,"matDatepicker"],["matSuffix","",3,"for"],["paydateid",""],[1,"col-lg-12"],["matInput","","formControlName","details"],["formArrayName","products"],[1,"pt-2","pb-1"],[1,"bg-secondary-light","py-2"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"text-end"],["type","button",1,"btn","btn-primary","my-2",3,"click"],[1,"fa","fa-plus"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"disabled","click"],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[1,"alert","alert-danger","my-3"],[3,"value"],[3,"formGroupName"],[1,"d-flex"],[1,"flex-grow-1","me-2"],[1,"col-lg-5","pt-1"],["formControlName","productid",3,"change"],[1,"col-lg-2"],["matInput","","placeholder","Enter No Of Items e.g. 50","formControlName","noitems",3,"errorStateMatcher","keyup"],["matInput","","placeholder","Enter Unit","formControlName","unitprice",3,"errorStateMatcher","keyup"],[1,"col-lg-3"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher","keyup"],[1,""],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"],["class","ms-1",4,"ngIf"],[1,"ms-1"],[1,"btn","btn-success",3,"disabled","click"],[1,"fa","fa-save"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._UZ(3,"i",3),t._uU(4," Back "),t.qZA()()(),t.TgZ(5,"form",4),t.YNc(6,Q,2,1,"div",5),t.TgZ(7,"div",6)(8,"div",7)(9,"ng-select",8),t.YNc(10,E,4,1,"ng-container",9),t.qZA()(),t.TgZ(11,"div",7)(12,"ng-select",10)(13,"ng-option",11),t._uU(14,"Select Mode OF Payment"),t.qZA(),t.YNc(15,O,3,2,"ng-container",12),t.qZA()()(),t.TgZ(16,"div",13)(17,"div",7)(18,"mat-form-field",14)(19,"mat-label"),t._uU(20,"Transaction Code"),t.qZA(),t._UZ(21,"input",15),t.qZA()(),t.TgZ(22,"div",7)(23,"mat-form-field",14)(24,"mat-label"),t._uU(25,"Payment Date"),t.qZA(),t._UZ(26,"input",16)(27,"mat-datepicker-toggle",17)(28,"mat-datepicker",null,18),t.qZA()()(),t.TgZ(30,"div",13)(31,"div",19)(32,"mat-form-field",14)(33,"mat-label"),t._uU(34,"Payment Description"),t.qZA(),t._UZ(35,"textarea",20),t.qZA()()(),t.TgZ(36,"div",21)(37,"div",22),t._uU(38," Products"),t.qZA(),t.TgZ(39,"div",23),t.YNc(40,B,29,7,"div",24),t.qZA(),t.TgZ(41,"div",25)(42,"button",26),t.NdJ("click",function(){return n.addProduct()}),t._UZ(43,"i",27),t.qZA()()(),t.TgZ(44,"button",28),t.NdJ("click",function(){return n.delOverallPay()}),t._uU(45,"Delete"),t.qZA(),t.TgZ(46,"button",29),t.NdJ("click",function(){return n.editOverallPay()}),t._uU(47,"Save Changes "),t.qZA()()),2&e){const o=t.MAs(29);t.xp6(5),t.Q6J("formGroup",n.payForm),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(4),t.Q6J("ngIf",n.suppliers),t.xp6(5),t.Q6J("ngForOf",n.modeOfPay),t.xp6(6),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("matDatepicker",o),t.xp6(1),t.Q6J("for",o),t.xp6(13),t.Q6J("ngForOf",n.getProducts.controls),t.xp6(4),t.Q6J("disabled",n.errorMessage||n.loading),t.xp6(2),t.Q6J("disabled",n.payForm.invalid||n.payForm.pristine)}},directives:[u.rH,d._Y,d.JL,d.sg,p.O5,h.w9,d.JJ,d.u,h.jq,p.sg,g.KE,g.hX,v.Nt,d.Fj,_.hl,_.nW,g.R9,_.Mq,d.CE,d.x0,x.lW],styles:[".mat-form-field-flex>.mat-form-field-infix{padding:.5em 0!important}  .mat-form-field-label-wrapper{top:-1.4em}  .mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{transform:translateY(-1.1em) scale(.75);width:133.33333%}"]}),a})();var K=l(5245),j=l(4107),z=l(6186),V=l(508),G=l(4586);function R(a,i){if(1&a&&(t.TgZ(0,"div",31),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function X(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",32),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.hij(" ",e.fullname.toUpperCase(),"")}}function W(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",11),t._uU(2,"Please Select A Supplier"),t.qZA(),t.YNc(3,X,3,2,"ng-container",12),t.BQk()),2&a){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.suppliers)}}function $(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",32),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.value),t.xp6(1),t.hij(" ",e.name,"")}}function tt(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",32),t._uU(2),t.qZA(),t.BQk()),2&a){const e=i.$implicit;t.xp6(1),t.Q6J("value",1*e.id),t.xp6(1),t.HOy(" ",e.categoryname.toUpperCase()," - ",e.brand.toUpperCase()," - ",e.prdtype.toUpperCase()," - ",e.calibration.toUpperCase()," ")}}function et(a,i){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",11),t._uU(2,"Please Select A Product"),t.qZA(),t.YNc(3,tt,3,5,"ng-container",12),t.BQk()),2&a){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.products)}}function nt(a,i){if(1&a){const e=t.EpF();t.TgZ(0,"div",33)(1,"div",34)(2,"div",35)(3,"div",13)(4,"div",36)(5,"ng-select",37),t.NdJ("change",function(){const r=t.CHM(e).index;return t.oxw().changeProduct(r)}),t.YNc(6,et,4,1,"ng-container",9),t.qZA()(),t.TgZ(7,"div",38)(8,"mat-form-field",14)(9,"mat-label"),t._uU(10," No Of Items"),t.qZA(),t.TgZ(11,"input",39),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().noitmKeyUp(o.target,s)}),t.qZA()()(),t.TgZ(12,"div",38)(13,"mat-form-field",14)(14,"mat-label"),t._uU(15,"Unit Price"),t.qZA(),t.TgZ(16,"input",40),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().unitKeyUp(o.target,s)}),t.qZA()()(),t.TgZ(17,"div",41)(18,"mat-form-field",14)(19,"mat-label"),t._uU(20,"Total Amount"),t.qZA(),t.TgZ(21,"input",42),t.NdJ("keyup",function(o){const s=t.CHM(e).index;return t.oxw().totlKeyup(o.target,s)}),t.qZA()()()()(),t.TgZ(22,"div",43)(23,"button",44),t.NdJ("click",function(){const r=t.CHM(e).index;return t.oxw().delProduct(r)}),t._UZ(24,"i",45),t.qZA()()()()}if(2&a){const e=i.index,n=t.oxw();t.Q6J("formGroupName",e),t.xp6(6),t.Q6J("ngIf",n.products),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(2),t.Q6J("disabled",0==e)}}function at(a,i){1&a&&(t.ynx(0),t._UZ(1,"i",46),t.TgZ(2,"span",43),t._uU(3,"Loading..."),t.qZA(),t.BQk())}function ot(a,i){1&a&&t._uU(0," Add Payment ")}let rt=(()=>{class a{constructor(e,n,o,r){this.payFb=e,this.router=n,this.snakBar=o,this.payServ=r,this.matcher=new Z.n,this.loading=!1,this.today=new Date,this.modeOfPay=[{name:"CASH",value:1},{name:"MPESA",value:2},{name:"PAYPAL",value:3},{name:"CHEQUE",value:4}],this.payForm=this.payFb.group({clisupid:["",d.kI.required],modeofpay:["",d.kI.required],paymentdate:[this.today,d.kI.required],transactioncode:["",d.kI.required],products:this.payFb.array([]),details:[""]})}ngOnInit(){this.loadProd(),this.loadSuppl(),this.addProduct(),this.payForm.valueChanges.subscribe(()=>{this.errorMessage=!1})}get getProducts(){return this.payForm.get("products")}addProduct(){const e=this.payFb.group({productid:["",d.kI.required],noitems:[0,d.kI.required],unitprice:[0,d.kI.required],totalamount:[0,d.kI.required]});this.getProducts.push(e)}delProduct(e){this.getProducts.removeAt(e)}loadProd(){this.payServ.getProducts({page:1,pageSize:10}).subscribe({next:e=>this.products=e.results,error:e=>this.errorHandle(e)})}loadSuppl(){this.payServ.getSuppliers({page:1,pageSize:10}).subscribe({next:e=>this.suppliers=e.results,error:e=>this.errorHandle(e)})}addPay(){this.loading=!0;let e=this.payForm.value;e.paymentdate=(0,p.p6)(e.paymentdate,"yyyy-MM-dd","en-US"),this.payServ.addPayment(e).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/expense/payment"])}errorHandle(e){this.loading=!1,this.errorMessage=e}unitKeyUp(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value);null===(r=this.getProducts.at(n).get("totalamount"))||void 0===r||r.setValue(e.value*s)}totlKeyup(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("noitems"))||void 0===o?void 0:o.value)||1;null===(r=this.getProducts.at(n).get("unitprice"))||void 0===r||r.setValue(e.value/s)}noitmKeyUp(e,n){var o,r;const s=parseInt(null===(o=this.getProducts.at(n).get("unitprice"))||void 0===o?void 0:o.value);null===(r=this.getProducts.at(n).get("totalamount"))||void 0===r||r.setValue(e.value*s)}changeProduct(e){var n,o;const r=null===(n=this.getProducts.at(e).get("productid"))||void 0===n?void 0:n.value,s=this.products.find(m=>m.id==r);null===(o=this.getProducts.at(e).get("unitprice"))||void 0===o||o.setValue(s.defbuyprice)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(d.qu),t.Y36(u.F0),t.Y36(y.ux),t.Y36(f))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-add-payment"]],decls:48,vars:11,consts:[[1,"d-lg-flex","text-secondary","py-2"],[1,"flex-grow-1"],["type","button","routerLink","/expense/payment",1,"btn","btn-outline-success","btn-sm"],["aria-hidden","true",1,"fa","fa-chevron-left"],[3,"formGroup"],["class","alert alert-danger my-3",4,"ngIf"],[1,"row","pb-4"],[1,"col-lg-6"],["formControlName","clisupid"],[4,"ngIf"],["formControlName","modeofpay"],["value","","disabled",""],[4,"ngFor","ngForOf"],[1,"row"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Enter Transaction code","formControlName","transactioncode",3,"errorStateMatcher"],["matInput","","formControlName","paymentdate",3,"matDatepicker"],["matSuffix","",3,"for"],["paydateid",""],[1,"col-lg-12"],["matInput","","formControlName","details"],["formArrayName","products"],[1,"pt-2","pb-1"],[1,"bg-secondary-light","py-2"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"text-end"],["type","button",1,"btn","btn-primary","my-2",3,"click"],[1,"fa","fa-plus"],["mat-flat-button","","color","primary","type","button",1,"me-3",3,"disabled","click"],[4,"ngIf","ngIfElse"],["notload",""],[1,"alert","alert-danger","my-3"],[3,"value"],[3,"formGroupName"],[1,"d-flex"],[1,"flex-grow-1","me-2"],[1,"col-lg-5","pt-1"],["formControlName","productid",3,"change"],[1,"col-lg-2"],["matInput","","placeholder","Enter No Of Items e.g. 50","formControlName","noitems",3,"errorStateMatcher","keyup"],["matInput","","placeholder","Enter Unit","formControlName","unitprice",3,"errorStateMatcher","keyup"],[1,"col-lg-3"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher","keyup"],[1,""],[1,"btn","btn-danger",3,"disabled","click"],[1,"fa","fa-trash"],[1,"fa","fa-spinner","fa-spin","fa-1x","me-2"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._UZ(3,"i",3),t._uU(4," Back "),t.qZA()()(),t.TgZ(5,"form",4),t.YNc(6,R,2,1,"div",5),t.TgZ(7,"div",6)(8,"div",7)(9,"ng-select",8),t.YNc(10,W,4,1,"ng-container",9),t.qZA()(),t.TgZ(11,"div",7)(12,"ng-select",10)(13,"ng-option",11),t._uU(14,"Select Mode OF Payment"),t.qZA(),t.YNc(15,$,3,2,"ng-container",12),t.qZA()()(),t.TgZ(16,"div",13)(17,"div",7)(18,"mat-form-field",14)(19,"mat-label"),t._uU(20,"Transaction Code"),t.qZA(),t._UZ(21,"input",15),t.qZA()(),t.TgZ(22,"div",7)(23,"mat-form-field",14)(24,"mat-label"),t._uU(25,"Payment Date"),t.qZA(),t._UZ(26,"input",16)(27,"mat-datepicker-toggle",17)(28,"mat-datepicker",null,18),t.qZA()()(),t.TgZ(30,"div",13)(31,"div",19)(32,"mat-form-field",14)(33,"mat-label"),t._uU(34,"Payment Description"),t.qZA(),t._UZ(35,"textarea",20),t.qZA()()(),t.TgZ(36,"div",21)(37,"div",22),t._uU(38," Add Products"),t.qZA(),t.TgZ(39,"div",23),t.YNc(40,nt,25,6,"div",24),t.qZA(),t.TgZ(41,"div",25)(42,"button",26),t.NdJ("click",function(){return n.addProduct()}),t._UZ(43,"i",27),t.qZA()()(),t.TgZ(44,"button",28),t.NdJ("click",function(){return n.addPay()}),t.YNc(45,at,4,0,"ng-container",29),t.YNc(46,ot,1,0,"ng-template",null,30,t.W1O),t.qZA()()),2&e){const o=t.MAs(29),r=t.MAs(47);t.xp6(5),t.Q6J("formGroup",n.payForm),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(4),t.Q6J("ngIf",n.suppliers),t.xp6(5),t.Q6J("ngForOf",n.modeOfPay),t.xp6(6),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("matDatepicker",o),t.xp6(1),t.Q6J("for",o),t.xp6(13),t.Q6J("ngForOf",n.getProducts.controls),t.xp6(4),t.Q6J("disabled",n.payForm.invalid||n.errorMessage||n.loading),t.xp6(1),t.Q6J("ngIf",n.loading)("ngIfElse",r)}},directives:[u.rH,d._Y,d.JL,d.sg,p.O5,h.w9,d.JJ,d.u,h.jq,p.sg,g.KE,g.hX,v.Nt,d.Fj,_.hl,_.nW,g.R9,_.Mq,d.CE,d.x0,x.lW],styles:[".mat-form-field-flex>.mat-form-field-infix{padding:.5em 0!important}  .mat-form-field-label-wrapper{top:-1.4em}  .mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{transform:translateY(-1.1em) scale(.75);width:133.33333%}"]}),a})();var it=l(9744);const st=[{path:"",component:M},{path:"add",component:rt},{path:"edit/:id",component:D},{path:"**",redirectTo:"",pathMatch:"full"}];let dt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[p.ez,z.K,d.UX,h.A0,d.u5,y.ZX,g.lN,j.LD,v.c,K.Ps,x.ot,V.XK,_.FA,G.D,it.F,u.Bz.forChild(st)]]}),a})()}}]);