"use strict";(self.webpackChunkbiz_ke_frontend=self.webpackChunkbiz_ke_frontend||[]).push([[254],{7254:(tt,y,r)=>{r.r(y),r.d(y,{PayinvoiceModule:()=>G});var l=r(9808),d=r(1083),c=r(3075),_=r(7423),C=r(508),m=r(6856),v=r(7322),I=r(5245),x=r(7531),N=r(4107),P=r(7261),g=r(4376),E=r(6186),S=r(4586),t=r(5e3),Z=r(7347),F=r(1990),U=r(4701),q=r(2818);function J(a,o){if(1&a&&(t.TgZ(0,"div",5),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}const M=function(a){return["edit/",a]};function Q(a,o){if(1&a&&(t.TgZ(0,"tr",13)(1,"td",14),t._uU(2),t.qZA(),t.TgZ(3,"td",14),t._uU(4),t.ALo(5,"number"),t.qZA(),t.TgZ(6,"td",14),t._uU(7),t.qZA(),t.TgZ(8,"td",14),t._uU(9),t.ALo(10,"modeofpay"),t.qZA(),t.TgZ(11,"td",14),t._uU(12),t.ALo(13,"currency"),t.qZA(),t.TgZ(14,"td",14),t._uU(15),t.ALo(16,"date"),t.qZA(),t.TgZ(17,"td",14),t._uU(18),t.qZA()()),2&a){const e=o.$implicit,n=o.index;t.Q6J("routerLink",t.VKq(18,M,e.id)),t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(t.xi3(5,8,e.nvclsolpoid,"3.0-0")),t.xp6(3),t.Oqu(e.transactioncode),t.xp6(2),t.Oqu(t.lcZ(10,11,e.modeofpay)),t.xp6(3),t.Oqu(t.xi3(13,13,e.totalamount,"Ksh. ")),t.xp6(3),t.Oqu(t.lcZ(16,16,e.paymentdate)),t.xp6(3),t.Oqu(e.details)}}function k(a,o){if(1&a&&(t.ynx(0),t.YNc(1,Q,19,20,"tr",12),t.BQk()),2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.paidinvoices)}}function O(a,o){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"table",7)(3,"tbody")(4,"tr",8)(5,"th",9),t._uU(6,"#"),t.qZA(),t.TgZ(7,"th",9),t._uU(8,"Invoice No."),t.qZA(),t.TgZ(9,"th",9),t._uU(10,"Transaction Code"),t.qZA(),t.TgZ(11,"th",9),t._uU(12,"Mode Of Payment"),t.qZA(),t.TgZ(13,"th",9),t._uU(14,"Total Amount"),t.qZA(),t.TgZ(15,"th",9),t._uU(16,"Pay Date"),t.qZA(),t.TgZ(17,"th",9),t._uU(18,"Description"),t.qZA()(),t.YNc(19,k,2,1,"ng-container",10),t.qZA()()(),t.TgZ(20,"app-paginator",11),t.NdJ("newItemEvent",function(i){return t.CHM(e),t.oxw().paginatedCall(i)}),t.qZA(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(19),t.Q6J("ngIf",e.paidinvoices),t.xp6(1),t.Q6J("datafromdb",e.paginator)}}function L(a,o){if(1&a&&(t.TgZ(0,"div",16),t._uU(1),t.qZA()),2&a){const e=t.oxw(2);t.xp6(1),t.Oqu(e.loadmessage)}}function Y(a,o){if(1&a&&t.YNc(0,L,2,1,"div",15),2&a){const e=t.oxw();t.Q6J("ngIf",e.loading)}}let H=(()=>{class a{constructor(e,n){this.payServ=e,this.router=n,this.loading=!0,this.loadmessage="loading ...",this.ifSearched=!1,this.paginator={page:1,pageSize:10},this.options=[{searchName:"Transaction Code",searchParam:"transactioncode"},{searchName:"Mode Of Payment",searchParam:"modeofpay"},{searchName:"Transaction Date",searchParam:"paymentdate"},{searchName:"Invoice Number ",searchParam:"nvclsolpoid"}],this.labels={listname:"Transactions",addBtname:"Add Payment",searchPlaceholder:"Search Payment"}}ngOnInit(){this.loadPadinvoices()}loadPadinvoices(){this.payServ.getPayInvoices(this.paginator).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}handleResp(e){this.loading=!1,this.paidinvoices=e.results,this.ifSearched||(this.paidinvoiceStore=e),this.setPaginator(e)}errorHandle(e){this.loading=!1,this.errorMessage=e}paginatedCall(e){this.ifSearched=!1,this.setPaginator(this.paidinvoiceStore),this.paginator.page=e.page,this.loadPadinvoices()}searchFunction(e){this.setPaginator(this.paidinvoiceStore),this.errorMessage=null,this.ifSearched=!0,this.paidinvoices=this.paidinvoiceStore.results,this.paginator[e.searchParam]=e.searchValue,this.paidinvoices=this.paidinvoices.filter(n=>{var i;let s=(null===(i=n[e.searchParam])||void 0===i?void 0:i.toString())||"";return new RegExp(e.searchValue,"i").test(s)}),0==this.paidinvoices.length&&(this.paginator.page=1,this.loading=!0,this.loadmessage="Performing a Wider Search",this.loadPadinvoices())}closeSearchFunction(){this.paidinvoices=this.paidinvoiceStore.results,this.errorMessage=null,this.setPaginator(this.paidinvoiceStore)}setPaginator(e){this.paginator={page:1,pageSize:10},this.paginator.page=e.currentPage,this.paginator.totalItems=e.totalItems,this.paginator.pageSize=e.pageSize}navigateAdd(){this.router.navigate(["/income/payinvoice/add"])}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(Z.I),t.Y36(d.F0))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-list-payinvoices"]],decls:6,vars:6,consts:[[1,"container-fluid","py-3"],[3,"labels","searchoptions","backenddata","searchEmit","closeEmit","navigateEmit"],["class","alert alert-danger my-3",4,"ngIf"],[4,"ngIf","ngIfElse"],["nodata",""],[1,"alert","alert-danger","my-3"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-bordered","text-nowrap"],[1,"blhead","rounded"],[1,"text-light"],[4,"ngIf"],[3,"datafromdb","newItemEvent"],["class","cursor",3,"routerLink",4,"ngFor","ngForOf"],[1,"cursor",3,"routerLink"],[1,"tpad"],["class","alert alert-warning text-danger my-3",4,"ngIf"],[1,"alert","alert-warning","text-danger","my-3"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"app-search-tab",1),t.NdJ("searchEmit",function(s){return n.searchFunction(s)})("closeEmit",function(){return n.closeSearchFunction()})("navigateEmit",function(){return n.navigateAdd()}),t.qZA(),t.YNc(2,J,2,1,"div",2),t.YNc(3,O,21,2,"ng-container",3),t.YNc(4,Y,1,1,"ng-template",null,4,t.W1O),t.qZA()),2&e){const i=t.MAs(5);t.xp6(1),t.Q6J("labels",n.labels)("searchoptions",n.options)("backenddata",n.paidinvoices),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(1),t.Q6J("ngIf",n.paidinvoices&&!n.loading&&!n.errorMessage)("ngIfElse",i)}},directives:[F.O,l.O5,l.sg,d.rH,U.J],pipes:[l.JJ,q.p,l.H9,l.uU],styles:[""]}),a})();var B=r(5906);function D(a,o){if(1&a&&(t.TgZ(0,"div",25),t._uU(1),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessage," ")}}function w(a,o){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",26),t._uU(2),t.qZA(),t.BQk()),2&a){const e=o.$implicit;t.xp6(1),t.Q6J("value",1*e[0].id),t.xp6(1),t.hij(" INVOICE NO. 00",e[0].id," ")}}function V(a,o){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",15),t._uU(2,"Please Select Invoice To Pay"),t.qZA(),t.YNc(3,w,3,2,"ng-container",16),t.BQk()),2&a){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.invoices)}}function z(a,o){if(1&a&&(t.ynx(0),t.TgZ(1,"ng-option",26),t._uU(2),t.qZA(),t.BQk()),2&a){const e=o.$implicit;t.xp6(1),t.Q6J("value",1*e.value),t.xp6(1),t.hij(" ",e.name,"")}}function K(a,o){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw().delPayNvc()}),t._uU(2,"Delete"),t.qZA(),t.TgZ(3,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().editPayNvc()}),t._uU(4,"Save Changes "),t.qZA(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.errorMessage||e.loading),t.xp6(2),t.Q6J("disabled",e.paynvcForm.invalid||e.paynvcForm.pristine)}}function R(a,o){1&a&&(t.ynx(0),t._UZ(1,"i",31),t.TgZ(2,"span",32),t._uU(3,"Loading..."),t.qZA(),t.BQk())}function j(a,o){1&a&&t._uU(0," Add Payment ")}function W(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw().addPayNvc()}),t.YNc(1,R,4,0,"ng-container",23),t.YNc(2,j,1,0,"ng-template",null,30,t.W1O),t.qZA()}if(2&a){const e=t.MAs(3),n=t.oxw();t.Q6J("disabled",n.paynvcForm.invalid||n.errorMessage||n.loading),t.xp6(1),t.Q6J("ngIf",n.loading)("ngIfElse",e)}}let A=(()=>{class a{constructor(e,n,i,s,u){this.payFb=e,this.router=n,this.snakBar=i,this.payServ=s,this.route=u,this.matcher=new B.n,this.loading=!1,this.today=new Date,this.modeOfPay=[{name:"CASH",value:1},{name:"MPESA",value:2},{name:"PAYPAL",value:3},{name:"CHEQUE",value:4}],this.paynvcForm=this.payFb.group({lsolponvcid:["",c.kI.required],totalamount:[0,c.kI.required],totalpaid:[0,c.kI.required],modeofpay:["",c.kI.required],transactioncode:["",c.kI.required],paymentdate:[this.today,c.kI.required],details:[""]})}ngOnInit(){this.loadNvc(),this.paidnvcid=this.route.snapshot.paramMap.get("id"),this.paidnvcid&&this.loadPaidNvc(),this.paynvcForm.valueChanges.subscribe(()=>{this.errorMessage=!1})}loadNvc(){this.payServ.getInvoices({page:1,pageSize:10}).subscribe({next:e=>this.invoices=e.results,error:e=>this.errorHandle(e)})}loadPaidNvc(){this.loading=!0,this.payServ.getPayInvoice(this.paidnvcid).subscribe({next:e=>this.respPay(e),error:e=>this.errorHandle(e)})}addPayNvc(){this.loading=!0;let e=this.paynvcForm.value;e.paymentdate=(0,l.p6)(e.paymentdate,"yyyy-MM-dd","en-US"),this.payServ.addPayInvoice(e).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}editPayNvc(){this.loading=!0;let e=this.paynvcForm.value;e.paymentdate=(0,l.p6)(e.paymentdate,"yyyy-MM-dd","en-US"),this.payServ.updatPayInvoice(e,this.paidnvcid).subscribe({next:n=>this.handleResp(n),error:n=>this.errorHandle(n)})}delPayNvc(){this.loading=!0,this.payServ.delPayInvoice(this.paidnvcid).subscribe({next:e=>this.handleResp(e),error:e=>this.errorHandle(e)})}openSnakBar(e,n){this.snakBar.open(e,n,{duration:2500})}respPay(e){this.loading=!1,this.paynvcForm.patchValue({lsolponvcid:e.nvclsolpoid,totalamount:e.totalamount,modeofpay:e.modeofpay,transactioncode:e.transactioncode,paymentdate:e.paymentdate,details:e.details})}handleResp(e){this.loading=!1,this.openSnakBar(e.message,"Dismiss"),this.router.navigate(["/income/payinvoice"])}handlCateg(e){this.clients=e.results}errorHandle(e){this.loading=!1,this.errorMessage=e}unitKeyUp(e){var n,i;const s=parseInt(null===(n=this.paynvcForm.get("noitems"))||void 0===n?void 0:n.value);null===(i=this.paynvcForm.get("totalamount"))||void 0===i||i.setValue(e.value*s)}totlKeyup(e){var n,i;const s=parseInt(null===(n=this.paynvcForm.get("noitems"))||void 0===n?void 0:n.value)||1;null===(i=this.paynvcForm.get("unitprice"))||void 0===i||i.setValue(e.value/s)}noitmKeyUp(e){var n,i;const s=parseInt(null===(n=this.paynvcForm.get("unitprice"))||void 0===n?void 0:n.value);null===(i=this.paynvcForm.get("totalamount"))||void 0===i||i.setValue(e.value*s)}changeInvoice(){var e,n,i;const s=null===(e=this.paynvcForm.get("lsolponvcid"))||void 0===e?void 0:e.value;let u=[];for(let p=0;p<this.invoices.length;p++){const h=this.invoices[p];for(let f=0;f<h.length;f++)if(h[f].id==s){u=h;break}}let T=0,b=0;u.forEach(p=>{T+=p.totalamount,b+=p.nvclsopaidamount}),null===(n=this.paynvcForm.get("totalamount"))||void 0===n||n.setValue(T),null===(i=this.paynvcForm.get("totalpaid"))||void 0===i||i.setValue(b)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(c.qu),t.Y36(d.F0),t.Y36(P.ux),t.Y36(Z.I),t.Y36(d.gz))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-add-edit-payinvoice"]],decls:45,vars:10,consts:[[1,"d-lg-flex","text-secondary","py-2"],[1,"flex-grow-1"],["type","button","routerLink","/income/payinvoice",1,"btn","btn-outline-success","btn-sm"],["aria-hidden","true",1,"fa","fa-chevron-left"],[3,"formGroup"],["class","alert alert-danger my-3",4,"ngIf"],[1,"row","pb-4"],[1,"col-lg-12"],["formControlName","lsolponvcid",3,"change"],[4,"ngIf"],[1,"row"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Enter Total Amount","formControlName","totalamount",3,"errorStateMatcher","keyup"],[1,"col-lg-12","pb-4"],["formControlName","modeofpay"],["value","","disabled",""],[4,"ngFor","ngForOf"],[1,"col-lg-6"],["matInput","","placeholder","Enter Transaction code","formControlName","transactioncode",3,"errorStateMatcher"],["matInput","","formControlName","paymentdate",3,"matDatepicker"],["matSuffix","",3,"for"],["paydateid",""],["matInput","","formControlName","details"],[4,"ngIf","ngIfElse"],["noVoucher",""],[1,"alert","alert-danger","my-3"],[3,"value"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"disabled","click"],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",1,"me-3",3,"disabled","click"],["notload",""],[1,"fa","fa-spinner","fa-spin","fa-1x","me-2"],[1,""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t._UZ(3,"i",3),t._uU(4," Back "),t.qZA()()(),t.TgZ(5,"form",4),t.YNc(6,D,2,1,"div",5),t.TgZ(7,"div",6)(8,"div",7)(9,"ng-select",8),t.NdJ("change",function(){return n.changeInvoice()}),t.YNc(10,V,4,1,"ng-container",9),t.qZA()()(),t.TgZ(11,"div",10)(12,"div",7)(13,"mat-form-field",11)(14,"mat-label"),t._uU(15,"Total Amount"),t.qZA(),t.TgZ(16,"input",12),t.NdJ("keyup",function(s){return n.totlKeyup(s.target)}),t.qZA()()()(),t.TgZ(17,"div",10)(18,"div",13)(19,"ng-select",14)(20,"ng-option",15),t._uU(21,"Select Mode OF Payment"),t.qZA(),t.YNc(22,z,3,2,"ng-container",16),t.qZA()(),t.TgZ(23,"div",17)(24,"mat-form-field",11)(25,"mat-label"),t._uU(26,"Transaction Code"),t.qZA(),t._UZ(27,"input",18),t.qZA()(),t.TgZ(28,"div",17)(29,"mat-form-field",11)(30,"mat-label"),t._uU(31,"Payment Date"),t.qZA(),t._UZ(32,"input",19)(33,"mat-datepicker-toggle",20)(34,"mat-datepicker",null,21),t.qZA()()(),t.TgZ(36,"div",10)(37,"div",7)(38,"mat-form-field",11)(39,"mat-label"),t._uU(40,"Payment Description"),t.qZA(),t._UZ(41,"textarea",22),t.qZA()()(),t.YNc(42,K,5,2,"ng-container",23),t.YNc(43,W,4,3,"ng-template",null,24,t.W1O),t.qZA()),2&e){const i=t.MAs(35),s=t.MAs(44);t.xp6(5),t.Q6J("formGroup",n.paynvcForm),t.xp6(1),t.Q6J("ngIf",n.errorMessage),t.xp6(4),t.Q6J("ngIf",n.invoices),t.xp6(6),t.Q6J("errorStateMatcher",n.matcher),t.xp6(6),t.Q6J("ngForOf",n.modeOfPay),t.xp6(5),t.Q6J("errorStateMatcher",n.matcher),t.xp6(5),t.Q6J("matDatepicker",i),t.xp6(1),t.Q6J("for",i),t.xp6(9),t.Q6J("ngIf",n.paidnvcid)("ngIfElse",s)}},directives:[d.rH,c._Y,c.JL,c.sg,l.O5,g.w9,c.JJ,c.u,g.jq,l.sg,v.KE,v.hX,x.Nt,c.Fj,m.hl,m.nW,v.R9,m.Mq,_.lW],styles:[".mat-form-field-flex>.mat-form-field-infix{padding:.5em 0!important}  .mat-form-field-label-wrapper{top:-1.4em}  .mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{transform:translateY(-1.1em) scale(.75);width:133.33333%}"]}),a})();var X=r(9744);const $=[{path:"",component:H},{path:"add",component:A},{path:"edit/:id",component:A}];let G=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[l.ez,E.K,c.UX,g.A0,c.u5,P.ZX,v.lN,N.LD,x.c,I.Ps,_.ot,C.XK,m.FA,S.D,X.F,d.Bz.forChild($)]]}),a})()}}]);